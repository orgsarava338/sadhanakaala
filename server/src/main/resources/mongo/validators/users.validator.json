{
  "$jsonSchema": {
    "bsonType": "object",
    "title": "Users validation",
    "required": ["username", "email", "createdAt", "updatedAt"],
    "additionalProperties": false,
    "properties": {
      "_id": {
        "bsonType": "objectId"
      },
      "username": {
        "bsonType": "string",
        "description": "Unique username, 3-30 chars, letters/numbers/._- allowed",
        "minLength": 3,
        "maxLength": 30,
        "pattern": "^[A-Za-z0-9._-]+$"
      },
      "email": {
        "bsonType": "string",
        "description": "User email (basic pattern validation)",
        "minLength": 5,
        "maxLength": 254,
        "pattern": "^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$"
      },
      "passwordHash": {
        "bsonType": "string",
        "description": "Password hash (store only hashed passwords or use external auth).",
        "minLength": 60,
        "maxLength": 200
      },
      "displayName": {
        "bsonType": ["string", "null"],
        "description": "Human-friendly display name",
        "maxLength": 100
      },
      "avatarUrl": {
        "bsonType": ["string", "null"],
        "description": "Profile avatar URL",
        "maxLength": 1024,
        "pattern": "^(https?:\\/\\/).+"
      },
      "timezone": {
        "bsonType": ["string", "null"],
        "description": "IANA timezone (e.g. 'Asia/Kolkata')",
        "pattern": "^[A-Za-z_]+\\/[A-Za-z_]+(?:\\/[A-Za-z_]+)?$"
      },
      "locale": {
        "bsonType": ["string", "null"],
        "description": "Locale (e.g. 'en-US')",
        "pattern": "^[a-zA-Z]{2,3}(?:-[a-zA-Z0-9]+)?$"
      },
      "roles": {
        "bsonType": ["array"],
        "description": "User roles",
        "items": {
          "bsonType": "string"
        },
        "uniqueItems": true
      },
      "disabled": {
        "bsonType": "bool",
        "description": "Whether the account is disabled"
      },
      "preferences": {
        "bsonType": "object",
        "description": "Small preferences object",
        "additionalProperties": false,
        "properties": {
          "defaultSound": {
            "bsonType": ["string", "null"]
          },
          "defaultVolume": {
            "bsonType": ["double", "int", "null"],
            "minimum": 0,
            "maximum": 1
          },
          "darkMode": {
            "bsonType": ["bool", "null"]
          }
        }
      },
      "lastLoginAt": {
        "bsonType": ["date", "null"],
        "description": "Last login timestamp"
      },
      "createdAt": {
        "bsonType": "date"
      },
      "updatedAt": {
        "bsonType": "date"
      }
    }
  }
}
