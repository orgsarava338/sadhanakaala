{
  "$jsonSchema": {
    "bsonType": "object",
    "title": "Timers validation",
    "required": ["ownerId", "title", "durationSeconds", "createdAt", "updatedAt"],
    "additionalProperties": false,
    "properties": {
      "_id": {
        "bsonType": "objectId"
      },
      "ownerId": {
        "bsonType": "objectId",
        "description": "Reference to users._id"
      },
      "title": {
        "bsonType": "string",
        "description": "Short title for the timer",
        "minLength": 1,
        "maxLength": 200
      },
      "description": {
        "bsonType": ["string", "null"],
        "description": "Longer description / notes",
        "maxLength": 2000
      },
      "durationSeconds": {
        "bsonType": ["int", "long"],
        "description": "Total nominal duration in seconds (positive)",
        "minimum": 1
      },
      "rounds": {
        "bsonType": "int",
        "description": "Number of rounds/cycles",
        "minimum": 1
      },
      "intervalSeconds": {
        "bsonType": "int",
        "description": "Gap between rounds in seconds",
        "minimum": 0
      },
      "segments": {
        "bsonType": ["array", "null"],
        "description": "Optional sequence of labeled segments that sum to durationSeconds (sum not enforced by validator)",
        "items": {
          "bsonType": "object",
          "required": ["label", "durationSeconds"],
          "additionalProperties": false,
          "properties": {
            "label": {
              "bsonType": "string",
              "minLength": 1,
              "maxLength": 200
            },
            "durationSeconds": {
              "bsonType": ["int", "long"],
              "minimum": 1
            }
          }
        },
        "minItems": 0
      },
      "sound": {
        "bsonType": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "name": {
            "bsonType": ["string", "null"],
            "maxLength": 200
          },
          "volume": {
            "bsonType": ["double", "int", "null"],
            "minimum": 0,
            "maximum": 1
          },
          "fileUrl": {
            "bsonType": ["string", "null"],
            "pattern": "^(https?:\\/\\/).+"
          }
        }
      },
      "vibrate": {
        "bsonType": "bool",
        "description": "Whether to vibrate"
      },
      "isPublic": {
        "bsonType": "bool",
        "description": "Publicly visible"
      },
      "sharedWith": {
        "bsonType": ["array", "null"],
        "description": "List of userIds (objectId) who have explicit access",
        "items": {
          "bsonType": "objectId"
        },
        "uniqueItems": true
      },
      "tags": {
        "bsonType": ["array", "null"],
        "description": "Tags for discovery",
        "items": {
          "bsonType": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "uniqueItems": true
      },
      "timezone": {
        "bsonType": ["string", "null"],
        "description": "IANA timezone for scheduling",
        "pattern": "^[A-Za-z_]+\\/[A-Za-z_]+(?:\\/[A-Za-z_]+)?$"
      },
      "recurrence": {
        "bsonType": ["object", "null"],
        "description": "Optional recurrence scheduling data (application computes nextRunAt)",
        "additionalProperties": false,
        "properties": {
          "rrule": {
            "bsonType": ["string", "null"],
            "maxLength": 2000
          },
          "nextRunAt": {
            "bsonType": ["date", "null"]
          },
          "enabled": {
            "bsonType": "bool"
          }
        }
      },
      "usageCount": {
        "bsonType": ["int", "long"],
        "minimum": 0
      },
      "lastUsedAt": {
        "bsonType": ["date", "null"]
      },
      "archived": {
        "bsonType": "bool"
      },
      "shareToken": {
        "bsonType": ["string", "null"],
        "minLength": 8,
        "maxLength": 128
      },
      "meta": {
        "bsonType": ["object", "null"],
        "description": "Arbitrary meta: color, emoji, extra UI hints",
        "additionalProperties": true,
        "properties": {
          "color": {
            "bsonType": ["string", "null"],
            "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
          },
          "emoji": {
            "bsonType": ["string", "null"],
            "maxLength": 8
          }
        }
      },
      "createdAt": {
        "bsonType": "date"
      },
      "updatedAt": {
        "bsonType": "date"
      }
    }
  }
}
